<div class="todo-container">
  <header class="todo-header">
    <h1>My Todo List</h1>
    <p>Stay organized and get things done</p>
  </header>

  <!-- Add Todo Form -->
  <div class="add-todo-section">
    <div class="add-todo-form">
      <input
        type="text"
        [(ngModel)]="newTodo.title"
        placeholder="Task title"
        class="todo-input"
        (keyup.enter)="addTodo()"
      />
      <input
        type="text"
        [(ngModel)]="newTodo.description"
        placeholder="Description (optional)"
        class="todo-input"
        (keyup.enter)="addTodo()"
      />
      <button 
        (click)="addTodo()" 
        class="add-btn"
        [disabled]="!newTodo.title.trim() || loading()"
      >
        {{ loading() ? 'Adding...' : 'Add Task' }}
      </button>
    </div>
  </div>

  <!-- Todo Table -->
  <div class="table-container">
    @if (todos().length === 0) {
      <div class="empty-state">
        <h3>No tasks yet</h3>
        <p>Add your first task above to get started!</p>
      </div>
    } @else {
      <table class="todo-table">
        <thead>
          <tr>
            <th>Title</th>
            <th>Description</th>
            <th>Created</th>
            <th>Updated</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          @for (todo of todos(); track todo.id) {
            <tr>
              <td>{{ todo.title }}</td>
              <td>{{ todo.description || '-' }}</td>
              <td>{{ formatDate(todo.created_at) }}</td>
              <td>{{ formatDate(todo.updated_at) }}</td>
              <td>
                <div class="action-buttons">
                  <button (click)="openEditModal(todo)" class="edit-btn" [disabled]="loading()">Edit</button>
                  <button (click)="openDeleteModal(todo)" class="delete-btn" [disabled]="loading()">Delete</button>
                </div>
              </td>
            </tr>
          }
        </tbody>
      </table>
    }
  </div>

  <!-- Edit Modal -->
  @if (showEditModal()) {
    <div class="modal-overlay" (click)="closeEditModal()">
      <div class="modal" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <h3>Edit Task</h3>
          <button class="close-btn" (click)="closeEditModal()">&times;</button>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label>Title</label>
            <input type="text" [(ngModel)]="editForm.title" class="form-input" placeholder="Task title">
          </div>
          <div class="form-group">
            <label>Description</label>
            <textarea [(ngModel)]="editForm.description" class="form-textarea" placeholder="Task description" rows="3"></textarea>
          </div>
        </div>
        <div class="modal-footer">
          <button (click)="closeEditModal()" class="cancel-btn">Cancel</button>
          <button (click)="saveEdit()" class="save-btn" [disabled]="!editForm.title.trim() || loading()">{{ loading() ? 'Saving...' : 'Save Changes' }}</button>
        </div>
      </div>
    </div>
  }

  <!-- Delete Modal -->
  @if (showDeleteModal()) {
    <div class="modal-overlay" (click)="closeDeleteModal()">
      <div class="modal" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <h3>Delete Task</h3>
          <button class="close-btn" (click)="closeDeleteModal()">&times;</button>
        </div>
        <div class="modal-body">
          <p>Are you sure you want to delete "{{ selectedTodo()?.title }}"?</p>
          <p class="warning-text">This action cannot be undone.</p>
        </div>
        <div class="modal-footer">
          <button (click)="closeDeleteModal()" class="cancel-btn">Cancel</button>
          <button (click)="confirmDelete()" class="delete-btn" [disabled]="loading()">{{ loading() ? 'Deleting...' : 'Delete' }}</button>
        </div>
      </div>
    </div>
  }
</div>